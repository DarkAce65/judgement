version: "3.9"

services:
  proxy:
    build:
      context: .
      dockerfile: ./proxy/Dockerfile
      args:
        - "REACT_APP_API_HOST=$API_HOST"
        - "REACT_APP_API_ROOT=$API_ROOT"
    restart: on-failure
    env_file: .env
    networks:
      - proxy
    ports:
      - 80:80

  redis:
    build: ./redis
    restart: on-failure
    networks:
      - db

  server:
    build: ./server
    restart: on-failure
    env_file: .env
    networks:
      - proxy
      - db

networks:
  proxy:
  db:
